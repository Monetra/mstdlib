<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Mstdlib-1.0.0: Logging Subsystem</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Mstdlib-1.0.0
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__m__log.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">Modules</a>  </div>
  <div class="headertitle">
<div class="title">Logging Subsystem</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="groups"></a>
Modules</h2></td></tr>
<tr class="memitem:group__m__async__writer"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__async__writer.html">Asynchronous Writer</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__m__log__tag__ranges"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__log__tag__ranges.html">Tag Ranges</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__m__log__common"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__log__common.html">Common</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__m__log__stream"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__log__stream.html">Stream Module</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__m__log__nslog"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__log__nslog.html">NSLog Module</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__m__log__android"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__log__android.html">Android Module</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__m__log__file"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__log__file.html">Filesystem Module</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__m__log__syslog"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__log__syslog.html">Syslog Module</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__m__log__tcp__syslog"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__log__tcp__syslog.html">TCP Syslog Module</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__m__log__membuf"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__log__membuf.html">Memory Buffer Module</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;mstdlib/mstdlib_log.h&gt;</span></div></div><!-- fragment --><p>Example:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;mstdlib/mstdlib_log.h&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define STREAM_QUEUE_SIZE (1500*1000) // 1.5 MB - small enough to cause a few drops, since all threads combined will</span></div><div class="line">                                      <span class="comment">// output about 1.7 MB of data</span></div><div class="line"><span class="preprocessor">#define FILE_QUEUE_SIZE   (1500*1000) // 1.5 MB</span></div><div class="line"><span class="preprocessor">#define SYSLOG_QUEUE_SIZE (10*1000)   // 10 KB</span></div><div class="line"><span class="preprocessor">#define CRIT_FREQ  (500)      // critical messages are sent every time message count hits a multiple of this number</span></div><div class="line"><span class="preprocessor">#define NUM_MSGS   (10*1000)  // total number of messages to send</span></div><div class="line"></div><div class="line"><span class="comment">//#define FILE_DO_ARCHIVE //Uncomment to test file archiving.</span></div><div class="line"><span class="comment">//#define ADD_LINE_END    //Uncomment to add embedded line endings to log messages (tests multiline functionality).</span></div><div class="line"></div><div class="line"><span class="comment">//#define DO_MEMBUF //Uncomment to test membuf.</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="preprocessor">#ifdef FILE_DO_ARCHIVE</span></div><div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *archive_cmd = <span class="stringliteral">&quot;bzip2 -f&quot;</span>;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *archive_ext = <span class="stringliteral">&quot;.bz2&quot;</span>;</div><div class="line"><span class="preprocessor">#else</span></div><div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *archive_cmd = NULL;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *archive_ext = NULL;</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> M_bool flush_on_destroy = M_TRUE;</div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> {</div><div class="line">    TAG_1  = 1 &lt;&lt; 0,</div><div class="line">    TAG_2  = 1 &lt;&lt; 1,</div><div class="line">    TAG_3  = 1 &lt;&lt; 2,</div><div class="line">    CRIT_1 = 1 &lt;&lt; 3,</div><div class="line">    CRIT_2 = 1 &lt;&lt; 4,</div><div class="line">    CRIT_3 = 1 &lt;&lt; 5</div><div class="line">} tags_t;</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *tag_to_str(tags_t tag)</div><div class="line">{</div><div class="line">    <span class="keywordflow">switch</span> (tag) {</div><div class="line">        <span class="keywordflow">case</span> TAG_1:  <span class="keywordflow">return</span> <span class="stringliteral">&quot;tag 1&quot;</span>;</div><div class="line">        <span class="keywordflow">case</span> TAG_2:  <span class="keywordflow">return</span> <span class="stringliteral">&quot;tag 2&quot;</span>;</div><div class="line">        <span class="keywordflow">case</span> TAG_3:  <span class="keywordflow">return</span> <span class="stringliteral">&quot;tag 3&quot;</span>;</div><div class="line">        <span class="keywordflow">case</span> CRIT_1: <span class="keywordflow">return</span> <span class="stringliteral">&quot;CRITICAL 1&quot;</span>;</div><div class="line">        <span class="keywordflow">case</span> CRIT_2: <span class="keywordflow">return</span> <span class="stringliteral">&quot;CRITICAL 2&quot;</span>;</div><div class="line">        <span class="keywordflow">case</span> CRIT_3: <span class="keywordflow">return</span> <span class="stringliteral">&quot;CRITICAL 3&quot;</span>;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> <span class="stringliteral">&quot;unknown tag&quot;</span>;</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div><div class="line">    <a class="code" href="group__m__log__common.html#gad41859c2eab8886cfdebb82ac5ba1f8d">M_log_t</a>    *log;</div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *msg;</div><div class="line">    tags_t      tag;</div><div class="line">    tags_t      crit_tag;</div><div class="line">} tdata_t;</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> <span class="keyword">set</span>(tdata_t *td, <a class="code" href="group__m__log__common.html#gad41859c2eab8886cfdebb82ac5ba1f8d">M_log_t</a> *log, <span class="keyword">const</span> <span class="keywordtype">char</span> *msg, tags_t tag, tags_t crit_tag)</div><div class="line">{</div><div class="line">    td-&gt;log      = log;</div><div class="line">    td-&gt;msg      = msg;</div><div class="line">    td-&gt;tag      = tag;</div><div class="line">    td-&gt;crit_tag = crit_tag;</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> prefix_cb(<a class="code" href="group__m__buf.html#ga6c543ecf0004fc310faa23c6ed8b267f">M_buf_t</a> *buf, M_uint64 tag, <span class="keywordtype">void</span> *prefix_thunk, <span class="keywordtype">void</span> *msg_thunk)</div><div class="line">{</div><div class="line">    (void)prefix_thunk;</div><div class="line">    (void)msg_thunk;</div><div class="line">    <a class="code" href="group__m__fmt.html#gaede402cdca9e7bcc2e3320f65a49934d">M_bprintf</a>(buf, <span class="stringliteral">&quot;: [%s]\t&quot;</span>, tag_to_str((tags_t)tag));</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> *test_thread(<span class="keywordtype">void</span> *arg)</div><div class="line">{</div><div class="line">    tdata_t  *td = arg;</div><div class="line">    M_uint64  i;</div><div class="line">    M_uint64  crit;</div><div class="line"></div><div class="line">    crit = CRIT_FREQ;</div><div class="line">    <span class="keywordflow">for</span> (i=0; i&lt;NUM_MSGS; i++) {</div><div class="line">        <a class="code" href="group__m__log__common.html#gab5f4f197e827f0ecab0b79f0f2478672">M_log_error_t</a> err;</div><div class="line">        tags_t        tag;</div><div class="line"></div><div class="line">        <span class="comment">//M_thread_sleep(10*1000); //Add 10 ms delay</span></div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (crit &gt;= CRIT_FREQ) {</div><div class="line">            tag = td-&gt;crit_tag;</div><div class="line">            crit = 1;</div><div class="line">        } <span class="keywordflow">else</span> {</div><div class="line">            tag = td-&gt;tag;</div><div class="line">            ++crit;</div><div class="line">        }</div><div class="line"></div><div class="line">        err = <a class="code" href="group__m__log__common.html#gaf5790176e869dbbef6b11e63080307a1">M_log_printf</a>(td-&gt;log, tag, NULL,</div><div class="line">#ifdef ADD_LINE_END</div><div class="line">            <span class="stringliteral">&quot;%s --\n   %llu&quot;</span>,</div><div class="line">#<span class="keywordflow">else</span></div><div class="line">            <span class="stringliteral">&quot;%s -- %llu&quot;</span>,</div><div class="line">#endif</div><div class="line">            td-&gt;msg, i);</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (err != <a class="code" href="group__m__log__common.html#ggab5f4f197e827f0ecab0b79f0f2478672ac9ea11b5dde45747bcd05224db585048">M_LOG_SUCCESS</a>) {</div><div class="line">            <a class="code" href="group__m__fmt.html#ga244d7165926719558f6472697f1fafa9">M_fprintf</a>(stderr, <span class="stringliteral">&quot;Error writing log message: %s\n&quot;</span>, <a class="code" href="group__m__log__common.html#ga7a60b3635bd2c4db809f47ce8089ffad">M_log_err_to_str</a>(err));</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> NULL;</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div><div class="line">{</div><div class="line">    <a class="code" href="group__m__log__common.html#gad41859c2eab8886cfdebb82ac5ba1f8d">M_log_t</a>         *log;</div><div class="line">    <a class="code" href="group__m__log__common.html#gab5f4f197e827f0ecab0b79f0f2478672">M_log_error_t</a>    res;</div><div class="line">    <a class="code" href="group__m__log__common.html#gaa367697cdf319431c22adec6f4e08c53">M_log_module_t</a>  *mod_stream;</div><div class="line">    <a class="code" href="group__m__log__common.html#gaa367697cdf319431c22adec6f4e08c53">M_log_module_t</a>  *mod_syslog;</div><div class="line">    <a class="code" href="group__m__log__common.html#gaa367697cdf319431c22adec6f4e08c53">M_log_module_t</a>  *mod_file;</div><div class="line"><span class="preprocessor">#ifdef DO_MEMBUF</span></div><div class="line">    <a class="code" href="group__m__log__common.html#gaa367697cdf319431c22adec6f4e08c53">M_log_module_t</a>  *mod_membuf;</div><div class="line">    <a class="code" href="group__m__fs__common.html#ga3f48055e7fc13f13df9c6bb9cdebd5fb">M_fs_file_t</a>     *membuf_out;</div><div class="line">    <a class="code" href="group__m__buf.html#ga6c543ecf0004fc310faa23c6ed8b267f">M_buf_t</a>         *membuf;</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">    <a class="code" href="group__m__thread__common__create.html#ga8365ddefe78fb767a9fc80347192b4ff">M_thread_attr_t</a> *attr;</div><div class="line">    <a class="code" href="group__m__thread__common__create.html#gaff7324b3e6d67d3479d047eb79beb06c">M_threadid_t</a>     t1, t2, t3;</div><div class="line">    tdata_t          data1, data2, data3;</div><div class="line"></div><div class="line">    (void)argc;</div><div class="line">    (void)argv;</div><div class="line"></div><div class="line">    <span class="comment">// Set up the log.</span></div><div class="line">    log = <a class="code" href="group__m__log__common.html#ga047a827cc4dd3ce8fbade99af21eab70">M_log_create</a>(<a class="code" href="group__m__log__common.html#gga30bbd00fb22bc02ccab5430640387357a9000b0d26226274b09571831d5631773">M_LOG_LINE_END_NATIVE</a>, flush_on_destroy, NULL);</div><div class="line">    <a class="code" href="group__m__log__common.html#ga11296f366e6edf201946d3b8333d94c7">M_log_set_time_format</a>(log, <span class="stringliteral">&quot;[%a %D %Y %H:%m:%s:%u %z]&quot;</span>);</div><div class="line">    <a class="code" href="group__m__log__common.html#ga14b387cbdb39546dfad2476e7e6730cd">M_log_set_tag_name</a>(log, TAG_1,  <span class="stringliteral">&quot;tag_1_name&quot;</span>);</div><div class="line">    <a class="code" href="group__m__log__common.html#ga14b387cbdb39546dfad2476e7e6730cd">M_log_set_tag_name</a>(log, TAG_2,  <span class="stringliteral">&quot;tag_2_name&quot;</span>);</div><div class="line">    <a class="code" href="group__m__log__common.html#ga14b387cbdb39546dfad2476e7e6730cd">M_log_set_tag_name</a>(log, TAG_3,  <span class="stringliteral">&quot;tag_3_name&quot;</span>);</div><div class="line">    <a class="code" href="group__m__log__common.html#ga14b387cbdb39546dfad2476e7e6730cd">M_log_set_tag_name</a>(log, CRIT_1, <span class="stringliteral">&quot;crit_1_name&quot;</span>);</div><div class="line">    <a class="code" href="group__m__log__common.html#ga14b387cbdb39546dfad2476e7e6730cd">M_log_set_tag_name</a>(log, CRIT_2, <span class="stringliteral">&quot;crit_2_name&quot;</span>);</div><div class="line">    <a class="code" href="group__m__log__common.html#ga14b387cbdb39546dfad2476e7e6730cd">M_log_set_tag_name</a>(log, CRIT_3, <span class="stringliteral">&quot;crit_3_name&quot;</span>);</div><div class="line"></div><div class="line">    <span class="comment">// Set up the stream module.</span></div><div class="line">    res = <a class="code" href="group__m__log__stream.html#gaf7362a0692ef03a115c4e3dbe9bbd4d1">M_log_module_add_stream</a>(log, <a class="code" href="group__m__log__common.html#ggaad0494abe774c0cd4d8ccd08b83707acad4ccd809b4e1adec34acad173e0ca187">M_STREAM_STDOUT</a>, STREAM_QUEUE_SIZE, &amp;mod_stream);</div><div class="line">    <span class="comment">//res = M_log_module_add_nslog(log, STREAM_QUEUE_SIZE, &amp;mod_stream);</span></div><div class="line">    <span class="keywordflow">if</span> (res != <a class="code" href="group__m__log__common.html#ggab5f4f197e827f0ecab0b79f0f2478672ac9ea11b5dde45747bcd05224db585048">M_LOG_SUCCESS</a>) {</div><div class="line">        <a class="code" href="group__m__fmt.html#ga244d7165926719558f6472697f1fafa9">M_fprintf</a>(stderr, <span class="stringliteral">&quot;Could not add stream module: %s\n&quot;</span>, <a class="code" href="group__m__log__common.html#ga7a60b3635bd2c4db809f47ce8089ffad">M_log_err_to_str</a>(res));</div><div class="line">    } <span class="keywordflow">else</span> {</div><div class="line">        <a class="code" href="group__m__log__common.html#ga1f4ddc20190c5f51991f18fae2cc897d">M_log_module_set_accepted_tags</a>(log, mod_stream, TAG_1 | TAG_2 | TAG_3 | CRIT_1 | CRIT_2 | CRIT_3);</div><div class="line"></div><div class="line">        <a class="code" href="group__m__log__common.html#ga3f2dde6446ee023e271486ae307b62d6">M_log_module_set_prefix</a>(log, mod_stream, prefix_cb, NULL, NULL);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// Set up the file module.</span></div><div class="line">    res = <a class="code" href="group__m__log__file.html#gad3ec781b1fd629505ebabaeafc7a1a88">M_log_module_add_file</a>(log, <span class="stringliteral">&quot;~/Tmp/logs/testing.log&quot;</span>, 15, 150000, 0, FILE_QUEUE_SIZE, archive_cmd, archive_ext, &amp;mod_file);</div><div class="line">    <span class="keywordflow">if</span> (res != <a class="code" href="group__m__log__common.html#ggab5f4f197e827f0ecab0b79f0f2478672ac9ea11b5dde45747bcd05224db585048">M_LOG_SUCCESS</a>) {</div><div class="line">        <a class="code" href="group__m__fmt.html#ga244d7165926719558f6472697f1fafa9">M_fprintf</a>(stderr, <span class="stringliteral">&quot;Could not add file module: %s\n&quot;</span>, <a class="code" href="group__m__log__common.html#ga7a60b3635bd2c4db809f47ce8089ffad">M_log_err_to_str</a>(res));</div><div class="line">    } <span class="keywordflow">else</span> {</div><div class="line">        <a class="code" href="group__m__log__common.html#ga1f4ddc20190c5f51991f18fae2cc897d">M_log_module_set_accepted_tags</a>(log, mod_file, TAG_1 | TAG_2 | TAG_3 | CRIT_1 | CRIT_2 | CRIT_3);</div><div class="line"></div><div class="line">        <a class="code" href="group__m__log__common.html#ga3f2dde6446ee023e271486ae307b62d6">M_log_module_set_prefix</a>(log, mod_file, prefix_cb, NULL, NULL);</div><div class="line">    }</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">// Set up the syslog module.</span></div><div class="line">    res = <a class="code" href="group__m__log__syslog.html#ga39bcc0c2b167413bf7cd16e49f624133">M_log_module_add_syslog</a>(log, <span class="stringliteral">&quot;log_example&quot;</span>, <a class="code" href="group__m__log__common.html#ggae989c31aaadfca433d924355faea2afaa5a1e3b2cb94bcf75174e46c24f58e01d">M_SYSLOG_FACILITY_LOCAL5</a>, SYSLOG_QUEUE_SIZE, &amp;mod_syslog);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (res != <a class="code" href="group__m__log__common.html#ggab5f4f197e827f0ecab0b79f0f2478672ac9ea11b5dde45747bcd05224db585048">M_LOG_SUCCESS</a>) {</div><div class="line">        <a class="code" href="group__m__fmt.html#ga244d7165926719558f6472697f1fafa9">M_fprintf</a>(stderr, <span class="stringliteral">&quot;Could not add syslog module: %s\n&quot;</span>, <a class="code" href="group__m__log__common.html#ga7a60b3635bd2c4db809f47ce8089ffad">M_log_err_to_str</a>(res));</div><div class="line">    } <span class="keywordflow">else</span> {</div><div class="line">        <a class="code" href="group__m__log__common.html#ga1f4ddc20190c5f51991f18fae2cc897d">M_log_module_set_accepted_tags</a>(log, mod_syslog, CRIT_1 | CRIT_2 | CRIT_3);</div><div class="line"></div><div class="line">        <a class="code" href="group__m__log__common.html#ga3f2dde6446ee023e271486ae307b62d6">M_log_module_set_prefix</a>(log, mod_syslog, prefix_cb, NULL, NULL);</div><div class="line"></div><div class="line">        <a class="code" href="group__m__log__syslog.html#ga37f3d919de260aab35fbe30b3b05067f">M_log_module_syslog_set_tag_priority</a>(log, mod_syslog, CRIT_1 | CRIT_2, <a class="code" href="group__m__log__common.html#ggae8930caa6ff473862599faf5002ffecea46d59af4b75014c1f9a8db145b63eb10">M_SYSLOG_WARNING</a>);</div><div class="line"></div><div class="line">        <a class="code" href="group__m__log__syslog.html#ga37f3d919de260aab35fbe30b3b05067f">M_log_module_syslog_set_tag_priority</a>(log, mod_syslog, CRIT_3, <a class="code" href="group__m__log__common.html#ggae8930caa6ff473862599faf5002ffecea6e2392cd9334dbcb9a0f168175fac49d">M_SYSLOG_CRIT</a>);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// Do an emergency call (just to see if it really works).</span></div><div class="line">    <a class="code" href="group__m__log__common.html#ga8d5bad7efcd30543fc2fdaeafba5a5f7">M_log_emergency</a>(log, <span class="stringliteral">&quot;RED ALERT! WOOT WOOT WOOT\r\n&quot;</span>);</div><div class="line"></div><div class="line">    <span class="comment">// Launch three test threads that spam the logger with a bunch of messages.</span></div><div class="line">    <span class="keyword">set</span>(&amp;data1, log, <span class="stringliteral">&quot;data1&quot;</span>, TAG_1, CRIT_1);</div><div class="line">    <span class="keyword">set</span>(&amp;data2, log, <span class="stringliteral">&quot;data2&quot;</span>, TAG_2, CRIT_2);</div><div class="line">    <span class="keyword">set</span>(&amp;data3, log, <span class="stringliteral">&quot;data3&quot;</span>, TAG_3, CRIT_3);</div><div class="line"></div><div class="line">    attr = <a class="code" href="group__m__thread__common__create.html#gaffbb2d659ce017851e30f429a57fe607">M_thread_attr_create</a>();</div><div class="line">    <a class="code" href="group__m__thread__common__create.html#gafce2d3e68ed6e4f3850225712cd63a7a">M_thread_attr_set_create_joinable</a>(attr, M_TRUE);</div><div class="line"></div><div class="line">    t1 = <a class="code" href="group__m__thread__common__create.html#ga21bd63f7d2c726646b7e3d62250c25c6">M_thread_create</a>(attr, test_thread, &amp;data1);</div><div class="line">    t2 = <a class="code" href="group__m__thread__common__create.html#ga21bd63f7d2c726646b7e3d62250c25c6">M_thread_create</a>(attr, test_thread, &amp;data2);</div><div class="line">    t3 = <a class="code" href="group__m__thread__common__create.html#ga21bd63f7d2c726646b7e3d62250c25c6">M_thread_create</a>(attr, test_thread, &amp;data3);</div><div class="line"></div><div class="line">    <a class="code" href="group__m__thread__common__create.html#ga42671ffa9ae57de51f410b2cc8b011b4">M_thread_attr_destroy</a>(attr);</div><div class="line"></div><div class="line"><span class="preprocessor">#ifdef DO_MEMBUF</span></div><div class="line">    <span class="comment">// Wait a little before we add the membuf module.</span></div><div class="line">    <a class="code" href="group__m__thread__common__create.html#gad157454b4bc8ece94d2c02e3a3c5b3a0">M_thread_sleep</a>(50*1000); <span class="comment">// 50 ms</span></div><div class="line"></div><div class="line">    res = <a class="code" href="group__m__log__membuf.html#gab0d5c672f055a436336dabe9850d4426">M_log_module_add_membuf</a>(log, 400*1000, 60*1000, NULL, NULL, &amp;mod_membuf);</div><div class="line">    <span class="keywordflow">if</span> (res != <a class="code" href="group__m__log__common.html#ggab5f4f197e827f0ecab0b79f0f2478672ac9ea11b5dde45747bcd05224db585048">M_LOG_SUCCESS</a>) {</div><div class="line">        <a class="code" href="group__m__fmt.html#ga244d7165926719558f6472697f1fafa9">M_fprintf</a>(stderr, <span class="stringliteral">&quot;Could not add membuf module: %s\n&quot;</span>, <a class="code" href="group__m__log__common.html#ga7a60b3635bd2c4db809f47ce8089ffad">M_log_err_to_str</a>(res));</div><div class="line">    } <span class="keywordflow">else</span> {</div><div class="line">        <a class="code" href="group__m__log__common.html#ga1f4ddc20190c5f51991f18fae2cc897d">M_log_module_set_accepted_tags</a>(log, mod_membuf, TAG_1 | CRIT_2);</div><div class="line"></div><div class="line">        <a class="code" href="group__m__log__common.html#ga3f2dde6446ee023e271486ae307b62d6">M_log_module_set_prefix</a>(log, mod_membuf, prefix_cb, NULL, NULL);</div><div class="line">    }</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line">    <span class="comment">// Do a suspend/resume operation.</span></div><div class="line">    <a class="code" href="group__m__log__common.html#ga559e3916ec04226c1a0dc9616b75291e">M_log_suspend</a>(log);</div><div class="line">    <a class="code" href="group__m__thread__common__create.html#gad157454b4bc8ece94d2c02e3a3c5b3a0">M_thread_sleep</a>(500); <span class="comment">// sleep for 0.5 ms</span></div><div class="line">    <a class="code" href="group__m__log__common.html#ga9d33ad83b858cb0d8d6c90038aab6777">M_log_resume</a>(log, NULL);</div><div class="line"></div><div class="line">    <span class="comment">// Wait until all three threads are done spamming.</span></div><div class="line">    <a class="code" href="group__m__thread__common__create.html#ga8fdc6d5a069b6d9ca601ffe9753e0355">M_thread_join</a>(t1, NULL);</div><div class="line">    <a class="code" href="group__m__thread__common__create.html#ga8fdc6d5a069b6d9ca601ffe9753e0355">M_thread_join</a>(t2, NULL);</div><div class="line">    <a class="code" href="group__m__thread__common__create.html#ga8fdc6d5a069b6d9ca601ffe9753e0355">M_thread_join</a>(t3, NULL);</div><div class="line"></div><div class="line"><span class="preprocessor">#ifdef DO_MEMBUF</span></div><div class="line">    <span class="comment">// Pull contents of membuf, dump to file.</span></div><div class="line">    <a class="code" href="group__m__log__membuf.html#gadeab6519c8e80ef50edd2a6c46a57f15">M_log_module_take_membuf</a>(log, mod_membuf, &amp;membuf);</div><div class="line"></div><div class="line">    <a class="code" href="group__m__fs__file.html#gab765a6b15ae978ec3899234f2df873e5">M_fs_file_open</a>(&amp;membuf_out, <span class="stringliteral">&quot;~/Tmp/logs/log_membuf.txt&quot;</span>, 0, <a class="code" href="group__m__fs__common.html#gga42d679aef8153f47777e00c6d44da706afca27cb38e231cdfddb674e81d073e6e">M_FS_FILE_MODE_WRITE</a> | <a class="code" href="group__m__fs__common.html#gga42d679aef8153f47777e00c6d44da706a4f8da501b2468477a3c3e92a20551958">M_FS_FILE_MODE_OVERWRITE</a>, NULL);</div><div class="line">    <a class="code" href="group__m__fs__file.html#gafbc0fc720e0bd04847d2ea2c3a3adf85">M_fs_file_write</a>(membuf_out, (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)<a class="code" href="group__m__buf.html#gaa971e69f90069433ea14d20bf83cc2a4">M_buf_peek</a>(membuf), <a class="code" href="group__m__buf.html#gaaff39362df33795d6c188ca3482a12cd">M_buf_len</a>(membuf),</div><div class="line">        NULL, <a class="code" href="group__m__fs__common.html#gga0f8cc9e131a2dce01e0a12581bf702fbae349a74afc91cbe92e295cb0146166e5">M_FS_FILE_RW_NORMAL</a>);</div><div class="line">    <a class="code" href="group__m__fs__file.html#ga3bef24378ff0e3a3f71213a2b1647e3e">M_fs_file_close</a>(membuf_out);</div><div class="line"></div><div class="line">    <a class="code" href="group__m__buf.html#gad51baebd5e46ee8231e78b926ccb198e">M_buf_cancel</a>(membuf);</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line">    <span class="comment">// Destroy the log. If internal workers are still processing messages, this will wait until they finish outputting</span></div><div class="line">    <span class="comment">// their internal message queues and exit. This ensures that we don&#39;t see any memory leaks at process exit.</span></div><div class="line">    <span class="comment">//</span></div><div class="line">    <span class="comment">// Wait up to five seconds for threads to finish writing.</span></div><div class="line">    <a class="code" href="group__m__log__common.html#ga910bc157931e27cd47d17f6eddf67b8e">M_log_destroy_blocking</a>(log, 5000);</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> EXIT_SUCCESS;</div><div class="line">}</div></div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Feb 20 2018 12:46:11 for Mstdlib-1.0.0 by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
