<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Mstdlib-1.0.0: SQL Connection Management</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Mstdlib-1.0.0
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__m__sql__conn.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">Modules</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">SQL Connection Management<div class="ingroups"><a class="el" href="group__m__sql.html">SQL Subsystem</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="groups"></a>
Modules</h2></td></tr>
<tr class="memitem:group__m__sql__trace"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__sql__trace.html">SQL Pool Tracing</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:ga36847634817b89efb01054d49e3c6352"><td class="memItemLeft" align="right" valign="top">typedef struct M_sql_connpool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__sql__conn.html#ga36847634817b89efb01054d49e3c6352">M_sql_connpool_t</a></td></tr>
<tr class="separator:ga36847634817b89efb01054d49e3c6352"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:ga2272f071ed4f702373040e54869a440f"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__sql__conn.html#ga2272f071ed4f702373040e54869a440f">M_sql_connpool_flags_t</a> { <br />
&#160;&#160;<a class="el" href="group__m__sql__conn.html#gga2272f071ed4f702373040e54869a440fa4643441ae6685be5d2244c2c4260c824">M_SQL_CONNPOOL_FLAG_NONE</a> = 0, 
<br />
&#160;&#160;<a class="el" href="group__m__sql__conn.html#gga2272f071ed4f702373040e54869a440fa4cba1aad8d8630c5ca7fd635f64713ea">M_SQL_CONNPOOL_FLAG_PRESPAWN_ALL</a> = 1 &lt;&lt; 0, 
<br />
&#160;&#160;<a class="el" href="group__m__sql__conn.html#gga2272f071ed4f702373040e54869a440fad0511a265695d86e94749fc97511cc37">M_SQL_CONNPOOL_FLAG_NO_AUTORETRY_QUERY</a> = 1 &lt;&lt; 1, 
<br />
&#160;&#160;<a class="el" href="group__m__sql__conn.html#gga2272f071ed4f702373040e54869a440fafe7b8c6f8b49c8405c07492de0bcea52">M_SQL_CONNPOOL_FLAG_LOAD_BALANCE</a> = 1 &lt;&lt; 2
<br />
 }</td></tr>
<tr class="separator:ga2272f071ed4f702373040e54869a440f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga41644e971fa760195ee96bc2e216e15e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__m__sql__error.html#gaae10ff11eb7d5583afcffa6ec87c753e">M_sql_error_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__sql__conn.html#ga41644e971fa760195ee96bc2e216e15e">M_sql_connpool_create</a> (<a class="el" href="group__m__sql__conn.html#ga36847634817b89efb01054d49e3c6352">M_sql_connpool_t</a> **pool, const char *driver, const char *conn_str, const char *username, const char *password, size_t max_conns, M_uint32 flags, char *error, size_t error_size)</td></tr>
<tr class="separator:ga41644e971fa760195ee96bc2e216e15e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga3c7b71410aee58ae987d51b9d90adb0d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__m__sql__error.html#gaae10ff11eb7d5583afcffa6ec87c753e">M_sql_error_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__sql__conn.html#ga3c7b71410aee58ae987d51b9d90adb0d">M_sql_connpool_add_readonly_pool</a> (<a class="el" href="group__m__sql__conn.html#ga36847634817b89efb01054d49e3c6352">M_sql_connpool_t</a> *pool, const char *conn_str, size_t max_conns, char *error, size_t error_size)</td></tr>
<tr class="separator:ga3c7b71410aee58ae987d51b9d90adb0d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga41d833f20685195f16c511a94adc6e58"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__sql__conn.html#ga41d833f20685195f16c511a94adc6e58">M_sql_connpool_set_timeouts</a> (<a class="el" href="group__m__sql__conn.html#ga36847634817b89efb01054d49e3c6352">M_sql_connpool_t</a> *pool, <a class="el" href="group__m__time.html#ga4a70f026dae39fde5310040a740351d2">M_time_t</a> reconnect_time_s, <a class="el" href="group__m__time.html#ga4a70f026dae39fde5310040a740351d2">M_time_t</a> max_idle_time_s, <a class="el" href="group__m__time.html#ga4a70f026dae39fde5310040a740351d2">M_time_t</a> fallback_s)</td></tr>
<tr class="separator:ga41d833f20685195f16c511a94adc6e58"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga914764d101fe47dfb48b36f83d3c87e8"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__m__sql__error.html#gaae10ff11eb7d5583afcffa6ec87c753e">M_sql_error_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__sql__conn.html#ga914764d101fe47dfb48b36f83d3c87e8">M_sql_connpool_start</a> (<a class="el" href="group__m__sql__conn.html#ga36847634817b89efb01054d49e3c6352">M_sql_connpool_t</a> *pool, char *error, size_t error_size)</td></tr>
<tr class="separator:ga914764d101fe47dfb48b36f83d3c87e8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf0250336086cafa40055c71038d36c48"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__m__sql__error.html#gaae10ff11eb7d5583afcffa6ec87c753e">M_sql_error_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__sql__conn.html#gaf0250336086cafa40055c71038d36c48">M_sql_connpool_destroy</a> (<a class="el" href="group__m__sql__conn.html#ga36847634817b89efb01054d49e3c6352">M_sql_connpool_t</a> *pool)</td></tr>
<tr class="separator:gaf0250336086cafa40055c71038d36c48"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga52221adc09c553f50275ec6af25e7097"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__sql__conn.html#ga52221adc09c553f50275ec6af25e7097">M_sql_connpool_active_conns</a> (<a class="el" href="group__m__sql__conn.html#ga36847634817b89efb01054d49e3c6352">M_sql_connpool_t</a> *pool, M_bool readonly)</td></tr>
<tr class="separator:ga52221adc09c553f50275ec6af25e7097"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga972a2a1a1222c1944997bcd0de194277"><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__sql__conn.html#ga972a2a1a1222c1944997bcd0de194277">M_sql_connpool_server_version</a> (<a class="el" href="group__m__sql__conn.html#ga36847634817b89efb01054d49e3c6352">M_sql_connpool_t</a> *pool)</td></tr>
<tr class="separator:ga972a2a1a1222c1944997bcd0de194277"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga01eba45c727027abc7f0e4bfbb9eae98"><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__sql__conn.html#ga01eba45c727027abc7f0e4bfbb9eae98">M_sql_connpool_driver_display_name</a> (<a class="el" href="group__m__sql__conn.html#ga36847634817b89efb01054d49e3c6352">M_sql_connpool_t</a> *pool)</td></tr>
<tr class="separator:ga01eba45c727027abc7f0e4bfbb9eae98"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga4ad80eb2b99f9ce4a56f0df3bee3d740"><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__sql__conn.html#ga4ad80eb2b99f9ce4a56f0df3bee3d740">M_sql_connpool_driver_name</a> (<a class="el" href="group__m__sql__conn.html#ga36847634817b89efb01054d49e3c6352">M_sql_connpool_t</a> *pool)</td></tr>
<tr class="separator:ga4ad80eb2b99f9ce4a56f0df3bee3d740"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga7ac0e5ea0d934685180ff2f94c226a69"><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__sql__conn.html#ga7ac0e5ea0d934685180ff2f94c226a69">M_sql_connpool_driver_version</a> (<a class="el" href="group__m__sql__conn.html#ga36847634817b89efb01054d49e3c6352">M_sql_connpool_t</a> *pool)</td></tr>
<tr class="separator:ga7ac0e5ea0d934685180ff2f94c226a69"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>SQL Connection Management </p>
<h2 class="groupheader">Typedef Documentation</h2>
<a id="ga36847634817b89efb01054d49e3c6352"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga36847634817b89efb01054d49e3c6352">&#9670;&nbsp;</a></span>M_sql_connpool_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct M_sql_connpool <a class="el" href="group__m__sql__conn.html#ga36847634817b89efb01054d49e3c6352">M_sql_connpool_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Connection pool object </p>

</div>
</div>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a id="ga2272f071ed4f702373040e54869a440f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga2272f071ed4f702373040e54869a440f">&#9670;&nbsp;</a></span>M_sql_connpool_flags_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="group__m__sql__conn.html#ga2272f071ed4f702373040e54869a440f">M_sql_connpool_flags_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Flags controlling behavior of the connection pool </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="gga2272f071ed4f702373040e54869a440fa4643441ae6685be5d2244c2c4260c824"></a>M_SQL_CONNPOOL_FLAG_NONE&#160;</td><td class="fielddoc"><p>No special pool flags </p>
</td></tr>
<tr><td class="fieldname"><a id="gga2272f071ed4f702373040e54869a440fa4cba1aad8d8630c5ca7fd635f64713ea"></a>M_SQL_CONNPOOL_FLAG_PRESPAWN_ALL&#160;</td><td class="fielddoc"><p>Pre-spawn all connections, not just the first. Without this, the remaining connections are on-demand </p>
</td></tr>
<tr><td class="fieldname"><a id="gga2272f071ed4f702373040e54869a440fad0511a265695d86e94749fc97511cc37"></a>M_SQL_CONNPOOL_FLAG_NO_AUTORETRY_QUERY&#160;</td><td class="fielddoc"><p>If a non-transactional query is rolled back due to a deadlock or connectivity failure, the default behavior is to automatically retry the query, indefinitely. For queries executed as part of a transaction, rollbacks must be handled by the caller as they may be dependent on prior queries in the transaction. This flag will turn off the auto-retry logic </p>
</td></tr>
<tr><td class="fieldname"><a id="gga2272f071ed4f702373040e54869a440fafe7b8c6f8b49c8405c07492de0bcea52"></a>M_SQL_CONNPOOL_FLAG_LOAD_BALANCE&#160;</td><td class="fielddoc"><p>If there are multiple servers specified for the connection string, this will load balance requests across the servers instead of using them for failover. </p>
</td></tr>
</table>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga41644e971fa760195ee96bc2e216e15e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga41644e971fa760195ee96bc2e216e15e">&#9670;&nbsp;</a></span>M_sql_connpool_create()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__m__sql__error.html#gaae10ff11eb7d5583afcffa6ec87c753e">M_sql_error_t</a> M_sql_connpool_create </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__m__sql__conn.html#ga36847634817b89efb01054d49e3c6352">M_sql_connpool_t</a> **&#160;</td>
          <td class="paramname"><em>pool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>driver</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>conn_str</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>username</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>password</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>max_conns</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">M_uint32&#160;</td>
          <td class="paramname"><em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>error</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>error_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Create an SQL connection pool.</p>
<p>A connection pool is required to be able to run SQL transactions. An internal connection is automatically claimed for a transaction or statement, or will wait on an available connection.</p>
<dl class="section note"><dt>Note</dt><dd>The pool is not started untile <a class="el" href="group__m__sql__conn.html#ga914764d101fe47dfb48b36f83d3c87e8">M_sql_connpool_start()</a> is called, which must occur before the pool can be used by <a class="el" href="group__m__sql__stmt.html#ga24ff152c4adae378ff4886436706e4eb">M_sql_stmt_execute()</a> or <a class="el" href="group__m__sql__trans.html#ga6dbb6e001e37950596ccc40f05cedce9">M_sql_trans_begin()</a>.</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>Pool modifications such as <a class="el" href="group__m__sql__conn.html#ga3c7b71410aee58ae987d51b9d90adb0d">M_sql_connpool_add_readonly_pool()</a> and <a class="el" href="group__m__sql__trace.html#ga9e61fcf37de34309c19217100088039d">M_sql_connpool_add_trace()</a> must be called prior to <a class="el" href="group__m__sql__conn.html#ga914764d101fe47dfb48b36f83d3c87e8">M_sql_connpool_start()</a>.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">pool</td><td>Newly initialized pool object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">driver</td><td>Name of driver to use. If the driver is not already loaded, will attempt to load the driver module automatically. Driver modules are named mstdlib_sql_$driver.dll or mstdlib_sql_$driver.so as appropriate. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">conn_str</td><td>A driver-specific connection string or DSN. This string often configures the host/port, and available options for the driver in use. The connection strings are a set of key/value pairs, with keys seperated from the values with an equal sign (=), and values separated by a semi-colon (;). If quoting is in use, a single-quote (') is recognized, and an escape character of a single quote (') can be used such that to use a real single quote, you would use two single quotes. E.g. : <div class="fragment"><div class="line">host=10.130.40.5:3306;ssl=yes </div></div><!-- fragment --> Please see the documentation for your driver for available configuration options. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">username</td><td>Connection username. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">password</td><td>Connection password. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">max_conns</td><td>Maximum number of SQL connections to attempt to create. Valid range 1-1000. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">flags</td><td>Bitmap of <a class="el" href="group__m__sql__conn.html#ga2272f071ed4f702373040e54869a440f">M_sql_connpool_flags_t</a> options to configure. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">error</td><td>Buffer to hold error message. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">error_size</td><td>Size of error buffer passed in. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="group__m__sql__error.html#ggaae10ff11eb7d5583afcffa6ec87c753ea4321145ef534b2263011566a66b8bef8">M_SQL_ERROR_SUCCESS</a> on successful pool creation, otherwise one of the <a class="el" href="group__m__sql__error.html#gaae10ff11eb7d5583afcffa6ec87c753e">M_sql_error_t</a> errors. </dd></dl>

</div>
</div>
<a id="ga3c7b71410aee58ae987d51b9d90adb0d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga3c7b71410aee58ae987d51b9d90adb0d">&#9670;&nbsp;</a></span>M_sql_connpool_add_readonly_pool()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__m__sql__error.html#gaae10ff11eb7d5583afcffa6ec87c753e">M_sql_error_t</a> M_sql_connpool_add_readonly_pool </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__m__sql__conn.html#ga36847634817b89efb01054d49e3c6352">M_sql_connpool_t</a> *&#160;</td>
          <td class="paramname"><em>pool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>conn_str</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>max_conns</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>error</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>error_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Create a read-only pool attached to our already-created pool.</p>
<p>The read-only pool will automatically route SELECT transactions, not part of a transaction (e.g. not within a <a class="el" href="group__m__sql__trans.html#ga6dbb6e001e37950596ccc40f05cedce9">M_sql_trans_begin()</a> ... <a class="el" href="group__m__sql__trans.html#ga22fb450587f6dd829e3ad6b5ac4df3f2">M_sql_trans_commit()</a> block) to the read-only pool. This can be useful for report generation, where the data is coming from an asyncronous replication pool for reducing load on the master.</p>
<dl class="section note"><dt>Note</dt><dd>The caller can optionally use <a class="el" href="group__m__sql__stmt.html#gae9d6456db14c2ff8db0ae0187b1a2be7">M_sql_stmt_set_master_only()</a> to enforce routing of SELECT transactions to the read/write pool instead.</dd></dl>
<p>The read-only pool must share the same driver, username, password, and usage flags as specified via <a class="el" href="group__m__sql__conn.html#ga41644e971fa760195ee96bc2e216e15e">M_sql_connpool_create()</a>, and must be called before <a class="el" href="group__m__sql__conn.html#ga914764d101fe47dfb48b36f83d3c87e8">M_sql_connpool_start()</a>.</p>
<p>Only a single read-only pool per pool object is allowed, repeated calls to this function will result in a failure.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pool</td><td>Initialized pool object by <a class="el" href="group__m__sql__conn.html#ga41644e971fa760195ee96bc2e216e15e">M_sql_connpool_create()</a>. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">conn_str</td><td>A driver-specific connection string or DSN. This string often configures the host/port, and available options for the driver in use. The connection strings are a set of key/value pairs, with keys seperated from the values with an equal sign (=), and values separated by a semi-colon (;). If quoting is in use, a single-quote (') is recognized, and an escape character of a single quote (') can be used such that to use a real single quote, you would use two single quotes. E.g. : <div class="fragment"><div class="line">host=10.130.40.5:3306;ssl=yes </div></div><!-- fragment --> Please see the documentation for your driver for available configuration options. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">max_conns</td><td>Maximum number of SQL connections to attempt to create. Valid range 1-1000. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">error</td><td>Buffer to hold error message. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">error_size</td><td>Size of error buffer passed in. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="group__m__sql__error.html#ggaae10ff11eb7d5583afcffa6ec87c753ea4321145ef534b2263011566a66b8bef8">M_SQL_ERROR_SUCCESS</a> on successful readonly pool creation, otherwise one of the <a class="el" href="group__m__sql__error.html#gaae10ff11eb7d5583afcffa6ec87c753e">M_sql_error_t</a> errors. </dd></dl>

</div>
</div>
<a id="ga41d833f20685195f16c511a94adc6e58"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga41d833f20685195f16c511a94adc6e58">&#9670;&nbsp;</a></span>M_sql_connpool_set_timeouts()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void M_sql_connpool_set_timeouts </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__m__sql__conn.html#ga36847634817b89efb01054d49e3c6352">M_sql_connpool_t</a> *&#160;</td>
          <td class="paramname"><em>pool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__m__time.html#ga4a70f026dae39fde5310040a740351d2">M_time_t</a>&#160;</td>
          <td class="paramname"><em>reconnect_time_s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__m__time.html#ga4a70f026dae39fde5310040a740351d2">M_time_t</a>&#160;</td>
          <td class="paramname"><em>max_idle_time_s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__m__time.html#ga4a70f026dae39fde5310040a740351d2">M_time_t</a>&#160;</td>
          <td class="paramname"><em>fallback_s</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Set timeouts for connections on the pool. Timeouts can be used to prevent stale connections from being used if known firewall timers expire, or to force reconnects to possibly rebalance connections across multiple servers.</p>
<p>Typically these should be set before <a class="el" href="group__m__sql__conn.html#ga914764d101fe47dfb48b36f83d3c87e8">M_sql_connpool_start()</a> however it is safe to change these on an active pool.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pool</td><td>Initialized connection pool object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">reconnect_time_s</td><td>How many seconds to allow a connection to be used before a disconnection is forced. The connection will be terminated even if not idle, termination will occur when a connection is returned to the pool instead of prior to use to prevent unexpected delays. This can be used to either redistribute load after a node failure when load balancing, or to fall back to a prior host. Set to 0 for infinite, set to -1 to not change the current value. Default is 0. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">max_idle_time_s</td><td>Maximum amount of time a connection can have been idle to be used. Some firewalls may lose connection state after a given duration, so it may be advisable to set this to below that threshold so the connection will be forcibly terminated rather than use. The connection will be terminated before use and the consumer will attempt to grab a different connection from the pool, or start a new one if none are available. Set to 0 for infinite, set to -1 to not change the current value. Default is 0. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fallback_s</td><td>Number of seconds when a connection error occurs to a host before it is eligible for "fallback". If this isn't set, the only time the first host will be re-used is if the secondary host(s) also fail. This should be used in conjunction with reconnect_time_s. Set to 0 to never fallback, or -1 to not change the current value. Not relevant for load balancing, the host will always be in the attempt pool. Default is 0. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ga914764d101fe47dfb48b36f83d3c87e8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga914764d101fe47dfb48b36f83d3c87e8">&#9670;&nbsp;</a></span>M_sql_connpool_start()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__m__sql__error.html#gaae10ff11eb7d5583afcffa6ec87c753e">M_sql_error_t</a> M_sql_connpool_start </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__m__sql__conn.html#ga36847634817b89efb01054d49e3c6352">M_sql_connpool_t</a> *&#160;</td>
          <td class="paramname"><em>pool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>error</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>error_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Start the connection pool and make it ready for use.</p>
<p>At least one connection from the primary pool, and optionally the read-only pool will be started, controlled via the <a class="el" href="group__m__sql__conn.html#gga2272f071ed4f702373040e54869a440fa4cba1aad8d8630c5ca7fd635f64713ea">M_SQL_CONNPOOL_FLAG_PRESPAWN_ALL</a> flag.</p>
<p>If this returns a failure, either it can be attempted to be started again, or should be destroyed with <a class="el" href="group__m__sql__conn.html#gaf0250336086cafa40055c71038d36c48">M_sql_connpool_destroy()</a>. No other functions are eligible for use after a failed start.</p>
<dl class="section note"><dt>Note</dt><dd>This must be called once prior to being able to use <a class="el" href="group__m__sql__stmt.html#ga24ff152c4adae378ff4886436706e4eb">M_sql_stmt_execute()</a> or <a class="el" href="group__m__sql__trans.html#ga6dbb6e001e37950596ccc40f05cedce9">M_sql_trans_begin()</a>, but must be called after <a class="el" href="group__m__sql__conn.html#ga3c7b71410aee58ae987d51b9d90adb0d">M_sql_connpool_add_readonly_pool()</a> or <a class="el" href="group__m__sql__trace.html#ga9e61fcf37de34309c19217100088039d">M_sql_connpool_add_trace()</a>.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pool</td><td>Initialized pool object by <a class="el" href="group__m__sql__conn.html#ga41644e971fa760195ee96bc2e216e15e">M_sql_connpool_create()</a>. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">error</td><td>Buffer to hold error message. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">error_size</td><td>Size of error buffer passed in. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="group__m__sql__error.html#ggaae10ff11eb7d5583afcffa6ec87c753ea4321145ef534b2263011566a66b8bef8">M_SQL_ERROR_SUCCESS</a> on successful readonly pool creation, otherwise one of the <a class="el" href="group__m__sql__error.html#gaae10ff11eb7d5583afcffa6ec87c753e">M_sql_error_t</a> errors. </dd></dl>

</div>
</div>
<a id="gaf0250336086cafa40055c71038d36c48"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaf0250336086cafa40055c71038d36c48">&#9670;&nbsp;</a></span>M_sql_connpool_destroy()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__m__sql__error.html#gaae10ff11eb7d5583afcffa6ec87c753e">M_sql_error_t</a> M_sql_connpool_destroy </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__m__sql__conn.html#ga36847634817b89efb01054d49e3c6352">M_sql_connpool_t</a> *&#160;</td>
          <td class="paramname"><em>pool</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Destroy the SQL connection pool and close all open connections.</p>
<p>All connections must be idle/unused or will return a failure.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pool</td><td>Pool object to be destroyed </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="group__m__sql__error.html#ggaae10ff11eb7d5583afcffa6ec87c753ea4321145ef534b2263011566a66b8bef8">M_SQL_ERROR_SUCCESS</a> on successful pool destruction, otherwise one of the <a class="el" href="group__m__sql__error.html#gaae10ff11eb7d5583afcffa6ec87c753e">M_sql_error_t</a> errors. </dd></dl>

</div>
</div>
<a id="ga52221adc09c553f50275ec6af25e7097"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga52221adc09c553f50275ec6af25e7097">&#9670;&nbsp;</a></span>M_sql_connpool_active_conns()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t M_sql_connpool_active_conns </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__m__sql__conn.html#ga36847634817b89efb01054d49e3c6352">M_sql_connpool_t</a> *&#160;</td>
          <td class="paramname"><em>pool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">M_bool&#160;</td>
          <td class="paramname"><em>readonly</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Count of active/connected SQL connections.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pool</td><td>Initialized pool object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">readonly</td><td>M_TRUE if querying for readonly connections, M_FALSE for primary</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>count of active/connected SQL connections. </dd></dl>

</div>
</div>
<a id="ga972a2a1a1222c1944997bcd0de194277"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga972a2a1a1222c1944997bcd0de194277">&#9670;&nbsp;</a></span>M_sql_connpool_server_version()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* M_sql_connpool_server_version </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__m__sql__conn.html#ga36847634817b89efb01054d49e3c6352">M_sql_connpool_t</a> *&#160;</td>
          <td class="paramname"><em>pool</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>SQL server name and version</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pool</td><td>Initialized pool object</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>SQL server name and version </dd></dl>

</div>
</div>
<a id="ga01eba45c727027abc7f0e4bfbb9eae98"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga01eba45c727027abc7f0e4bfbb9eae98">&#9670;&nbsp;</a></span>M_sql_connpool_driver_display_name()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* M_sql_connpool_driver_display_name </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__m__sql__conn.html#ga36847634817b89efb01054d49e3c6352">M_sql_connpool_t</a> *&#160;</td>
          <td class="paramname"><em>pool</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>SQL driver display (pretty) name</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pool</td><td>Initialized pool object</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>SQL driver pretty name </dd></dl>

</div>
</div>
<a id="ga4ad80eb2b99f9ce4a56f0df3bee3d740"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga4ad80eb2b99f9ce4a56f0df3bee3d740">&#9670;&nbsp;</a></span>M_sql_connpool_driver_name()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* M_sql_connpool_driver_name </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__m__sql__conn.html#ga36847634817b89efb01054d49e3c6352">M_sql_connpool_t</a> *&#160;</td>
          <td class="paramname"><em>pool</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>SQL driver internal/short name</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pool</td><td>Initialized pool object</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>SQL driver internal/short name </dd></dl>

</div>
</div>
<a id="ga7ac0e5ea0d934685180ff2f94c226a69"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga7ac0e5ea0d934685180ff2f94c226a69">&#9670;&nbsp;</a></span>M_sql_connpool_driver_version()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* M_sql_connpool_driver_version </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__m__sql__conn.html#ga36847634817b89efb01054d49e3c6352">M_sql_connpool_t</a> *&#160;</td>
          <td class="paramname"><em>pool</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>SQL driver version (not db version)</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pool</td><td>Initialized pool object</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>SQL driver version (not db version) </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Feb 20 2018 12:46:13 for Mstdlib-1.0.0 by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
