<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Mstdlib-1.0.0: SQL Helpers</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Mstdlib-1.0.0
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__m__sql__helpers.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">SQL Helpers<div class="ingroups"><a class="el" href="group__m__sql.html">SQL Subsystem</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga5652e2f45f004c7e5bfa9599f70ec049"><td class="memItemLeft" align="right" valign="top">M_int64&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__sql__helpers.html#ga5652e2f45f004c7e5bfa9599f70ec049">M_sql_gen_timerand_id</a> (<a class="el" href="group__m__sql__conn.html#ga36847634817b89efb01054d49e3c6352">M_sql_connpool_t</a> *pool, size_t max_len)</td></tr>
<tr class="separator:ga5652e2f45f004c7e5bfa9599f70ec049"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga968e3bfef73d9b44d862dc70553d6afb"><td class="memItemLeft" align="right" valign="top">M_uint64&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__sql__helpers.html#ga968e3bfef73d9b44d862dc70553d6afb">M_sql_rollback_delay_ms</a> (<a class="el" href="group__m__sql__conn.html#ga36847634817b89efb01054d49e3c6352">M_sql_connpool_t</a> *pool)</td></tr>
<tr class="separator:ga968e3bfef73d9b44d862dc70553d6afb"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>SQL Helpers for various situations </p>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga5652e2f45f004c7e5bfa9599f70ec049"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga5652e2f45f004c7e5bfa9599f70ec049">&#9670;&nbsp;</a></span>M_sql_gen_timerand_id()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">M_int64 M_sql_gen_timerand_id </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__m__sql__conn.html#ga36847634817b89efb01054d49e3c6352">M_sql_connpool_t</a> *&#160;</td>
          <td class="paramname"><em>pool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>max_len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Generate a time-based + random unique id suitable for primary key use rather than using an auto-increment column.</p>
<p>It is not recommended to use auto-increment columns for portability reasons, therefore a suitable unique id needs to be chosen that has a low probability of conflict. There is no guarantee this key is unique, so integrators should handle conflicts by regenerating the key and re-attempting the operation (even though this may be an extremely low probability).</p>
<p>The generated key is a combination of the current timestamp in UTC and a random suffix. The reason for a timestamp prefix is some databases cannot handle purely random numbers as they cause index splits that cause exponential slowdown as the number of rows increase. This can be observed with MySQL in particular.</p>
<p>Where possible, a 64bit (signed) column should be used for the unique id, which has a maximum length of 18 digits where all digits can contain any value. A 32bit signed integer has a maximum of 9 digits where all digits can contain any value. 32bit integers are strongly discouraged as the possibility for conflict is much higher and would limit the total number of possible rows considerably (max 99,000 rows per day, but conflicts will be highly probable over a couple of thousand rows per day).</p>
<p>The current formats based on length are listed below:</p><ul>
<li>17-18+ digits : YYYJJJSSSSS{6-7R}</li>
<li>16 digits : YYJJJSSSSS{6R}</li>
<li>14-15 digits : YJJJSSSSS{5-6R}</li>
<li>13 digits : YJJJSSSS{6R}</li>
<li>11-12 digits : YJJJSS{6-7R}</li>
<li>9-10 digits : YJJJ{5-6R}</li>
<li>&lt;9 : {1-8R}</li>
</ul>
<p>Where:</p><ul>
<li>Y = last digit of year</li>
<li>YY = last 2 digits of year</li>
<li>YYY = last 3 digits of year</li>
<li>JJJ = Julian day of year (0-365)</li>
<li>SSSSS = Second of day (0-86399)</li>
<li>SSSS = Second of day divided by 10 (0-8639) (more fine grained than alternative of HHMM 0-2359)</li>
<li>SS = Second of day divided by 1000 (0-86) (more fine grained than alternative of HH 0-23)</li>
<li>{#R},{#-#R} = number of random digits</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>A time prefix is used solely for the purpose of reducing database load by making the values as incremental as possible, while still having a random portion to avoid conflicts. These are not meant to be human-interpretable numbers, and formats may change in the future. These should essentially appear completely random to a human.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pool</td><td>Initialized pool object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">max_len</td><td>Length of unique id to generate in digits. Valid range is 9-18. May return fewer digits only when the time prefix begins with zero. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>64bit signed integer representation of usable unique id, or 0 on misuse. </dd></dl>

</div>
</div>
<a id="ga968e3bfef73d9b44d862dc70553d6afb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga968e3bfef73d9b44d862dc70553d6afb">&#9670;&nbsp;</a></span>M_sql_rollback_delay_ms()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">M_uint64 M_sql_rollback_delay_ms </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__m__sql__conn.html#ga36847634817b89efb01054d49e3c6352">M_sql_connpool_t</a> *&#160;</td>
          <td class="paramname"><em>pool</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Random delay to use for a rollback to assist in preventing continual deadlocks and rollbacks.</p>
<p>A random delay is returned in milliseconds that can be used when a rollback condition is necessary to help break deadlock loops.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pool</td><td>Initialized pool object </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>delay to use in milliseconds. </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Feb 20 2018 12:46:13 for Mstdlib-1.0.0 by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
